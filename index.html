<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess — Room</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Require login + use Firebase username automatically -->
  <script type="module">
    import { auth, onAuthStateChanged } from "./firebase.js";
    onAuthStateChanged(auth, (u)=>{
      if(!u){
        location.href = "login.html?next=" + encodeURIComponent(location.href);
      }
    });
  </script>
  <script type="module" src="app.js"></script>
</head>
<body>
  <div class="container">
    <h1>Guess — Room</h1>

    <!-- Status header -->
    <div class="card" style="margin-bottom:12px">
      <div class="row" style="gap:10px;flex-wrap:wrap">
        <div class="pill">Your role: <b><span id="yourRole">—</span></b></div>
        <div class="pill">Room status: <b><span id="roomStatus">—</span></b></div>
        <div class="pill">Turn: <b><span id="turnNow">—</span></b></div>
        <div class="pill">Code length: <b><span id="codeLen">—</span></b></div>
        <div class="pill">Time left: <b><span id="timeLeft">—</span>s</b></div>
        <div style="flex:1"></div>
        <button id="copyLink" class="ghost">Copy Link</button>
        <button id="leaveBtn" class="">Leave</button>
        <button id="resetBtn" class="warn" style="display:none">Reset</button>
      </div>
      <div class="sep"></div>
      <div id="gameStatus" class="status" aria-live="polite"></div>
    </div>

    <!-- Banner / notices -->
    <div id="banner" class="winner warn" style="display:none"></div>

    <!-- Secret entry (only for the player himself while idle) -->
    <section class="card" style="margin-bottom:12px">
      <h3>Enter your secret number</h3>

      <div id="p1SecretRow" class="row" style="display:none;margin-top:8px">
        <label for="p1secret" style="min-width:180px">Secret (hidden):</label>
        <input id="p1secret" type="password" inputmode="numeric" maxlength="6" placeholder="••••"/>
        <button id="toggleP1" class="ghost" title="Show/Hide">👁</button>
      </div>

      <div id="p2SecretRow" class="row" style="display:none;margin-top:8px">
        <label for="p2secret" style="min-width:180px">Secret (hidden):</label>
        <input id="p2secret" type="password" inputmode="numeric" maxlength="6" placeholder="••••"/>
        <button id="toggleP2" class="ghost" title="Show/Hide">👁</button>
      </div>
    </section>

    <!-- Boards -->
    <div class="grid grid-two">
      <section id="p1Board" class="card" aria-labelledby="p1Title">
        <h2 id="p1Title" style="margin:0 0 10px;">Player 1 Board</h2>
        <div class="row">
          <div class="pill">Timer: <b><span id="p1Timer">—</span>s</b></div>
        </div>
        <div id="p1GuessRow" class="row" style="margin:8px 0">
          <label for="p1guess" style="min-width:140px">Your guess:</label>
          <input id="p1guess" type="text" inputmode="numeric" maxlength="6" placeholder="type & press Enter" disabled>
          <button id="p1Submit" disabled>Submit</button>
        </div>
        <table aria-label="Player 1 history">
          <thead><tr><th>#</th><th>Guess</th><th>Bulls</th></tr></thead>
          <tbody id="p1History"></tbody>
        </table>
      </section>

      <section id="p2Board" class="card" aria-labelledby="p2Title">
        <h2 id="p2Title" style="margin:0 0 10px;">Player 2 Board</h2>
        <div class="row">
          <div class="pill">Timer: <b><span id="p2Timer">—</span>s</b></div>
        </div>
        <div id="p2GuessRow" class="row" style="margin:8px 0">
          <label for="p2guess" style="min-width:140px">Your guess:</label>
          <input id="p2guess" type="text" inputmode="numeric" maxlength="6" placeholder="type & press Enter" disabled>
          <button id="p2Submit" disabled>Submit</button>
        </div>
        <table aria-label="Player 2 history">
          <thead><tr><th>#</th><th>Guess</th><th>Bulls</th></tr></thead>
          <tbody id="p2History"></tbody>
        </table>
      </section>
    </div>

    <div id="winnerArea" aria-live="polite" style="margin-top:12px"></div>

    <!-- Countdown overlay (3..2..1) -->
    <div id="overlay" style="position:fixed;inset:0;display:none;place-items:center;background:rgba(10,5,18,.35);backdrop-filter:blur(2px)">
      <div id="overlayContent" style="font-size:64px;font-weight:900;background: linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 28px rgba(255,79,183,.35)">3</div>
    </div>

    <!-- Hidden: player names (set by app.js using Firebase user displayName) -->
    <div style="display:none">
      <span id="p1Name"></span>
      <span id="p2Name"></span>
    </div>
  </div>
</body>
</html>
